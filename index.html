<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Looks | AI Try-On & Booking</title>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/dark.css">
    <link rel="stylesheet" href="style.css"> </head>
<body>

<div class="container">
    <header>
        <div class="logo">LOOKS</div>
        <p class="subtitle">Powered by Nano Banana AI</p>
    </header>

    <div id="try-on-display">
        <div id="loading-overlay" style="display:none;">Processing Look...</div>
        <img id="ai-result-img" src="placeholder-initial.jpg" alt="Your New Look">
    </div>

    <div class="filter-container">
        <button class="filter-btn active" onclick="filterStyles('all')">All</button>
        <button class="filter-btn" onclick="filterStyles('coily')">Coily</button>
        <button class="filter-btn" onclick="filterStyles('curly')">Curly</button>
        <button class="filter-btn" onclick="filterStyles('straight')">Straight</button>
    </div>

    <div id="style-grid" class="style-grid">
        </div>

    <button id="open-booking-btn" class="primary-btn">Book This Style Now</button>
</div>

<div id="booking-modal">
    <div class="modal-content">
        <h2>Secure Your Spot</h2>
        <p id="confirm-style-text"></p>

        <div class="form-group">
            <label>Select Date</label>
            <input type="text" id="booking-date" placeholder="Tap to pick date">
        </div>

        <div class="form-group">
            <label>Available Times</label>
            <select id="booking-time">
                <option value="">Select a date first...</option>
            </select>
        </div>

        <div class="form-group">
            <input type="text" id="client-name" placeholder="Full Name">
        </div>

        <div class="form-group">
            <input type="email" id="client-email" placeholder="Email Address">
        </div>

        <button id="final-confirm-btn" class="submit-btn">Confirm Appointment</button>
        <p id="status-msg"></p>
        
        <button class="close-modal" onclick="closeModal()">Back to Styles</button>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    // DATA: Our inclusive style library
    const hairstyles = [
        { id: 1, name: "Low Taper Fade", texture: "coily", complexion: "deep", img: "style1.jpg" },
        { id: 2, name: "Mid Fade", texture: "straight", complexion: "light", img: "style2.jpg" },
        { id: 3, name: "Textured Waves", texture: "curly", complexion: "medium", img: "style3.jpg" },
        // More styles added here...
    ];

    let currentSelectedStyle = hairstyles[0];

    // Initialize Page
    window.onload = () => {
        renderStyles('all');
    };

    // UI Logic: Filter and Render
    function renderStyles(filter) {
        const grid = document.getElementById('style-grid');
        grid.innerHTML = '';
        
        const filtered = filter === 'all' ? hairstyles : hairstyles.filter(h => h.texture === filter);
        
        filtered.forEach(style => {
            const div = document.createElement('div');
            div.className = `style-card ${currentSelectedStyle.id === style.id ? 'active' : ''}`;
            div.innerHTML = `<img src="${style.img}" alt="${style.name}"><p>${style.name}</p>`;
            div.onclick = () => selectStyle(style);
            grid.appendChild(div);
        });
    }

    function selectStyle(style) {
        currentSelectedStyle = style;
        document.getElementById('ai-result-img').src = style.img; // Simulating Nano Banana fast-swap
        renderStyles(document.querySelector('.filter-btn.active').innerText.toLowerCase());
    }

    // Booking Flow Logic
    const modal = document.getElementById('booking-modal');
    document.getElementById('open-booking-btn').onclick = () => {
        document.getElementById('confirm-style-text').innerText = `Style: ${currentSelectedStyle.name}`;
        modal.style.display = 'flex';
    };

    function closeModal() { modal.style.display = 'none'; }

    // Calendar Integration
    flatpickr("#booking-date", {
        minDate: "today",
        onChange: (selectedDates, dateStr) => {
            // Mock available times
            const select = document.getElementById('booking-time');
            select.innerHTML = '<option value="10:00">10:00 AM</option><option value="14:00">02:00 PM</option>';
        }
    });

    // FINAL SUBMISSION (to Netlify Function)
    document.getElementById('final-confirm-btn').onclick = async () => {
        const payload = {
            name: document.getElementById('client-name').value,
            email: document.getElementById('client-email').value,
            date: document.getElementById('booking-date').value,
            time: document.getElementById('booking-time').value,
            style: currentSelectedStyle.name,
            image: currentSelectedStyle.img
        };

        const response = await fetch('/.netlify/functions/save-booking', {
            method: 'POST',
            body: JSON.stringify(payload)
        });

        if(response.ok) {
            document.getElementById('status-msg').innerText = "Booked! Check your email.";
        }
    };
</script>
</body>
</html>
