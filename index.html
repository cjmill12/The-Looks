<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Looks - Virtual Hairstyle Try-On</title>
    
    <style>
/* --- PROFESSIONAL COLOR SCHEME --- */
:root {
    /* Updated Professional Colors */
    --primary-color: #1a1f36;
    --primary-light: #2d3548;
    --accent-color: #00d4ff;
    --accent-hover: #00b8e6;
    --success-color: #10b981;
    --success-hover: #059669;
    --text-on-dark: #FFFFFF;
    --background-color: #fafafa;
    --surface-color: #FFFFFF;
    --text-primary: #1f2937;
    --text-secondary: #6b7280;
    --border-color: #e5e7eb;
    
    /* Sizing */
    --header-height: 64px;
    --viewport-size-desktop: 360px;
    --viewport-size-mobile: 320px;
    --content-max-width: 440px;
    --border-radius-sm: 8px;
    --border-radius-md: 12px;
    --border-radius-lg: 16px;
    --border-radius-full: 9999px;
}

* {
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
    background-color: var(--background-color);
    color: var(--text-primary);
    margin: 0;
    padding: 0;
    text-align: center;
    -webkit-user-select: none;
    user-select: none;
    overflow-x: hidden;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    line-height: 1.6;
    transition: background-color 0.3s ease;
}

/* Smooth transitions for all interactive elements */
* {
    transition: opacity 0.3s ease, transform 0.3s ease;
}

/* --- PROFESSIONAL HEADER --- */
#app-header {
    padding: 0 20px;
    background-color: var(--surface-color);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
    height: var(--header-height);
    display: flex;
    align-items: center;
    justify-content: center;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    background-color: rgba(255, 255, 255, 0.95);
}

#main-title-container {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 0;
    padding: 0;
}

#main-title {
    color: var(--primary-color);
    font-size: 2em;
    font-weight: 700;
    line-height: 1;
    margin: 0;
    padding: 0;
    letter-spacing: -0.02em;
}

/* Remove logo - using text only */
#header-logo {
    display: none;
}

/* --- MAIN CONTAINER WITH BETTER SPACING --- */
#main-app-container {
    flex-grow: 1;
    width: 100%;
    padding: 16px 0 32px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
}

/* --- COMBINED FILTERS ROW (Compact, at bottom) --- */
#filters-combined-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    width: auto;
    max-width: 320px;
    margin: 4px auto 0;
    padding: 8px 14px;
    background-color: transparent;
    border-radius: var(--border-radius-full);
    box-shadow: none;
}

.filter-group {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
}

.filter-label {
    font-size: 0.65em;
    font-weight: 600;
    margin: 0;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.filter-separator {
    width: 1px;
    height: 36px;
    background-color: rgba(0, 0, 0, 0.1);
    flex-shrink: 0;
}

/* --- COMPACT GENDER BUTTONS --- */
.gender-buttons-container {
    display: flex;
    justify-content: center;
    gap: 5px;
    width: auto;
    margin: 0;
    padding: 0;
}

.gender-button {
    flex: 0 0 auto;
    min-width: 58px;
    padding: 5px 12px;
    border: 1.5px solid var(--border-color);
    background-color: var(--surface-color);
    color: var(--text-primary);
    border-radius: var(--border-radius-full);
    cursor: pointer;
    font-size: 0.75em;
    font-weight: 600;
    text-align: center;
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    user-select: none;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.gender-button:hover {
    background-color: #f9fafb;
    border-color: var(--primary-color);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
}

.gender-button.selected {
    background-color: var(--primary-color);
    color: var(--text-on-dark);
    border-color: var(--primary-color);
    box-shadow: 0 2px 6px rgba(26, 31, 54, 0.2);
}

/* --- CAMERA SECTION - POLISHED --- */
#central-section {
    width: 90%;
    max-width: var(--content-max-width);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 20px;
    padding: 0 16px;
}

#central-viewport {
    position: relative;
    width: var(--viewport-size-mobile);
    height: var(--viewport-size-mobile);
    max-width: var(--viewport-size-desktop);
    max-height: var(--viewport-size-desktop);
    margin: 0;
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    background: linear-gradient(135deg, #e0e7ff 0%, #f3f4f6 100%);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12), 0 4px 8px rgba(0, 0, 0, 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    flex-shrink: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

#central-viewport:hover {
    transform: scale(1.02);
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15), 0 5px 12px rgba(0, 0, 0, 0.1);
}

#camera-placeholder-icon {
    position: relative;
    width: 60%;
    height: 60%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    border: 3px dashed var(--text-secondary);
    border-radius: var(--border-radius-md);
    background-color: rgba(255, 255, 255, 0.5);
}

#camera-placeholder-icon::before {
    content: '';
    position: absolute;
    top: 15%;
    width: 40%;
    height: 40%;
    background-color: var(--text-secondary);
    border-radius: 50%;
}

#camera-placeholder-icon::after {
    content: '';
    position: absolute;
    bottom: -15%;
    width: 80%;
    height: 60%;
    background-color: var(--text-secondary);
    border-radius: 50% 50% 0 0;
}

#video-feed, #ai-result {
    width: 100%;
    height: 100%;
    display: block;
    object-fit: cover;
    max-width: 100%;
    max-height: 100%;
    z-index: 1;
    display: none;
}

#status-message {
    position: absolute;
    bottom: 0;
    width: 100%;
    background: linear-gradient(to top, rgba(0, 0, 0, 0.85), rgba(0, 0, 0, 0));
    color: white;
    padding: 16px 12px 12px;
    margin: 0;
    font-size: 0.9em;
    font-weight: 500;
    text-align: center;
    z-index: 100;
    letter-spacing: 0.01em;
}

/* --- LIVE PREVIEW OVERLAY --- */
#style-preview-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    border: 3px solid var(--accent-color);
    box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.3), 0 8px 20px rgba(0, 0, 0, 0.4);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 50;
    object-fit: cover;
    object-position: top;
    display: none;
}

#style-preview-overlay.active {
    opacity: 0.85;
}

#style-preview-overlay:hover {
    opacity: 0.95;
}

/* --- PROFESSIONAL BUTTONS --- */
.main-action-btn {
    cursor: pointer;
    border: none;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    font-weight: 600;
    letter-spacing: 0.01em;
}

.main-action-btn:hover {
    transform: translateY(-2px);
}

.main-action-btn:active {
    transform: translateY(0) scale(0.97);
    transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
}

.circular-action-btn {
    width: 64px;
    height: 64px;
    padding: 0;
    border-radius: 50%;
    background-color: rgba(26, 31, 54, 0.6);
    color: var(--text-on-dark);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    line-height: 1;
    margin: 0;
    flex-shrink: 0;
    box-shadow: 0 4px 14px rgba(26, 31, 54, 0.3);
}

.circular-action-btn:hover {
    box-shadow: 0 6px 20px rgba(26, 31, 54, 0.4);
}

/* --- Camera Button (iPhone Style) --- */
#camera-capture-btn {
    width: 66px;
    height: 66px;
    background-color: transparent;
    color: transparent;
    border: 4px solid rgba(255, 255, 255, 0.3);
    box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.5), 0 6px 20px rgba(0, 0, 0, 0.4);
    position: relative;
}

#camera-capture-btn::before {
    content: '';
    position: absolute;
    width: 50px;
    height: 50px;
    background-color: white;
    border-radius: 50%;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    transition: all 0.1s ease;
}

#camera-capture-btn:hover::before {
    background-color: #f5f5f5;
}

#camera-capture-btn:active::before {
    transform: translate(-50%, -50%) scale(0.88);
    background-color: #e8e8e8;
}

#generate-look-btn {
    background-color: var(--accent-color);
    color: var(--text-on-dark);
    box-shadow: 0 4px 14px rgba(0, 212, 255, 0.4);
}

#generate-look-btn:hover {
    background-color: var(--accent-hover);
    box-shadow: 0 6px 20px rgba(0, 212, 255, 0.5);
}

#redo-selfie-btn {
    background-color: var(--surface-color);
    color: var(--primary-color);
    border: 2px solid var(--border-color);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

#redo-selfie-btn:hover {
    border-color: var(--primary-color);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

#book-appointment-btn {
    width: auto;
    min-width: 160px;
    max-width: 200px;
    height: 38px;
    padding: 0 20px;
    border-radius: var(--border-radius-full);
    background: linear-gradient(135deg, var(--success-color) 0%, #0d9488 100%);
    color: var(--text-on-dark);
    font-size: 0.9em;
    font-weight: 700;
    box-shadow: 0 3px 10px rgba(16, 185, 129, 0.3);
    margin-top: 0;
    display: none;
    transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    letter-spacing: 0.02em;
}

#book-appointment-btn:hover {
    background: linear-gradient(135deg, #0d9488 0%, var(--success-color) 100%);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.4);
    transform: translateY(-2px);
}

#book-appointment-btn:active {
    transform: translateY(0) scale(0.98);
    box-shadow: 0 2px 8px rgba(16, 185, 129, 0.4);
}

#controls-footer-row {
    display: flex;
    justify-content: center;
    gap: 20px;
    width: 90%;
    max-width: var(--content-max-width);
    padding: 0 16px;
    min-height: 64px;
    align-items: center;
    position: relative;
    flex-wrap: wrap;
}

#loading-spinner {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 4px solid var(--border-color);
    border-top-color: var(--accent-color);
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: translate(-50%, -50%) rotate(360deg); }
}

/* --- VISIBLE FILTER PILLS --- */
.filter-section {
    width: 90%;
    max-width: var(--content-max-width);
    margin: 0 auto;
    padding: 0 16px;
    background-color: transparent;
    border-radius: 0;
    text-align: center;
}

.filter-section h3 {
    font-size: 0.85em;
    font-weight: 600;
    margin: 0;
    padding: 0;
    text-transform: none;
    letter-spacing: 0;
    display: none; /* Hide the header, show pills directly */
}

.filter-content-group {
    padding: 0;
    background-color: transparent;
    border-radius: 0;
}

.filter-section.collapsed .filter-content-group {
    display: flex; /* Always show, even when "collapsed" */
    justify-content: center;
}

.filter-section.expanded .filter-content-group {
    display: flex;
}

/* Complexion label */
.filter-content-group > p {
    font-size: 0.85em;
    font-weight: 600;
    margin: 0 0 8px 0;
    color: var(--text-secondary);
    text-align: center;
}

.filter-options-group {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: flex-start;
    margin-top: 8px;
}

#complexion-options-group {
    justify-content: center;
    gap: 8px;
    padding: 0;
    display: flex;
    flex-wrap: nowrap;
}

.complexion-tile {
    width: 32px;
    height: 32px;
    border: 2px solid transparent;
    flex-shrink: 0;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
}

.complexion-tile:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.complexion-tile p {
    display: none;
}

.complexion-tile.selected {
    border-color: var(--accent-color);
    box-shadow: 0 0 0 2px var(--surface-color), 0 0 0 4px var(--accent-color);
    transform: scale(1.15);
}

/* --- HAIRSTYLE GALLERY - SNAPCHAT STYLE --- */
#style-inspiration-section {
    width: 100%;
    max-width: 100vw;
    margin: 0;
    padding: 0;
    text-align: center;
    position: relative;
}

#style-inspiration-section p {
    font-size: 0.85em;
    font-weight: 600;
    margin: 0 0 12px 0;
    color: var(--text-secondary);
    letter-spacing: 0.02em;
    text-transform: uppercase;
}

.hairstyle-options-group-wrapper {
    display: flex;
    flex-wrap: nowrap;
    white-space: nowrap;
    overflow-x: scroll;
    overflow-y: hidden;
    scroll-snap-type: x mandatory;
    scroll-behavior: smooth;
    gap: 20px;
    padding: 0 calc(50vw - 60px) 20px; /* Center first/last items */
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
}

.hairstyle-options-group-wrapper::-webkit-scrollbar {
    display: none;
}

.style-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    width: 120px;
    flex-shrink: 0;
    border: 3px solid transparent;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    transform-origin: center;
    border-radius: var(--border-radius-md);
    padding: 6px;
    scroll-snap-align: center; /* Snap to center like Snapchat */
    scroll-snap-stop: always;
}

.style-option:hover {
    transform: scale(1.05);
}

.style-option.selected {
    border-color: var(--accent-color);
    border-radius: var(--border-radius-md);
    box-shadow: 0 0 0 2px var(--surface-color), 0 0 0 5px var(--accent-color), 0 8px 20px rgba(0, 212, 255, 0.3);
    transform: scale(1.2);
    z-index: 10;
}

.style-thumbnail {
    width: 112px;
    height: 112px;
    border-radius: 50%;
    object-fit: cover;
    object-position: top;
    margin-bottom: 0;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.style-option p {
    display: none;
}

/* --- MODAL - MODERN DESIGN --- */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.75);
    backdrop-filter: blur(4px);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    visibility: hidden;
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.modal-overlay.visible {
    visibility: visible;
    opacity: 1;
}

.booking-modal {
    background: var(--surface-color);
    padding: 32px;
    border-radius: var(--border-radius-lg);
    width: 90%;
    max-width: 440px;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    position: relative;
    max-height: 85vh;
    overflow-y: auto;
    animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.booking-modal h2 {
    margin-top: 0;
    color: var(--primary-color);
    font-size: 1.75em;
    font-weight: 700;
    border-bottom: 2px solid var(--border-color);
    padding-bottom: 16px;
    margin-bottom: 20px;
}

.modal-close-btn {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    font-size: 1.75em;
    cursor: pointer;
    color: var(--text-secondary);
    transition: all 0.2s;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.modal-close-btn:hover {
    background-color: #f3f4f6;
    color: var(--primary-color);
}

.modal-content label {
    display: block;
    margin-top: 16px;
    text-align: left;
    font-weight: 600;
    font-size: 0.95em;
    color: var(--text-primary);
    margin-bottom: 6px;
}

.modal-content input,
.modal-content select {
    width: 100%;
    padding: 14px 16px;
    margin-top: 0;
    box-sizing: border-box;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius-sm);
    font-size: 1em;
    font-family: inherit;
    transition: all 0.2s;
    background-color: var(--surface-color);
}

.modal-content input:focus,
.modal-content select:focus {
    outline: none;
    border-color: var(--accent-color);
    box-shadow: 0 0 0 3px rgba(0, 212, 255, 0.1);
}

.modal-content button.submit-btn {
    width: 100%;
    padding: 16px 32px;
    margin-top: 24px;
    background-color: var(--success-color);
    color: var(--text-on-dark);
    border: none;
    border-radius: var(--border-radius-sm);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 1.1em;
    font-weight: 700;
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.modal-content button.submit-btn:hover {
    background-color: var(--success-hover);
    box-shadow: 0 6px 18px rgba(16, 185, 129, 0.4);
    transform: translateY(-1px);
}

.modal-content button.submit-btn:disabled {
    background-color: #d1d5db;
    cursor: not-allowed;
    box-shadow: none;
    transform: none;
}

#reference-image-preview {
    width: 100%;
    height: auto;
    max-height: 120px;
    object-fit: contain;
    margin-top: 12px;
    border-radius: var(--border-radius-sm);
    border: 2px solid var(--border-color);
    display: block;
}

#booking-status-message {
    margin-top: 12px;
    font-weight: 600;
    font-size: 0.95em;
}

/* --- MOBILE RESPONSIVE --- */
@media (max-width: 600px) {
    :root {
        --header-height: 50px;
        --content-max-width: 100%;
    }

    #main-title {
        font-size: 1.5em;
    }

    #main-app-container {
        padding: 8px 0 20px;
        gap: 12px;
    }

    #filters-combined-row {
        gap: 12px;
        width: 95%;
        padding: 8px 12px;
        margin: 6px auto 0;
    }
    
    .filter-separator {
        width: 1px;
        height: 36px;
    }
    
    .filter-label {
        font-size: 0.65em;
    }
    
    .gender-button {
        min-width: 60px;
        padding: 5px 12px;
        font-size: 0.75em;
    }
    
    .complexion-tile {
        width: 30px;
        height: 30px;
    }
    
    #book-appointment-btn {
        min-width: 140px;
        max-width: 180px;
        height: 36px;
        font-size: 0.85em;
        padding: 0 18px;
    }
    
    #central-section,
    #controls-footer-row {
        width: 95%;
        max-width: 95%;
        padding: 0 12px;
    }
    
    #style-inspiration-section {
        width: 100%;
        max-width: 100vw;
        padding: 0;
    }

    #central-viewport {
        width: 70vw;
        height: 70vw;
        max-width: 300px;
        max-height: 300px;
    }

    .circular-action-btn {
        width: 52px;
        height: 52px;
        font-size: 22px;
    }
    
    #camera-capture-btn {
        width: 62px;
        height: 62px;
    }
    
    #camera-capture-btn::before {
        width: 46px;
        height: 46px;
    }

    #complexion-options-group {
        justify-content: center;
        gap: 12px;
        padding-bottom: 0;
        padding-top: 0;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
    }
    
    #complexion-options-group::-webkit-scrollbar {
        display: none;
    }

    .complexion-tile {
        width: 30px;
        height: 30px;
        flex-shrink: 0;
    }
    
    .gender-button {
        min-width: 52px;
        padding: 4px 10px;
        font-size: 0.72em;
    }
    
    #filters-combined-row {
        gap: 8px;
        padding: 6px 10px;
        max-width: 280px;
    }
    
    .filter-separator {
        height: 32px;
    }
    
    #book-appointment-btn {
        min-width: 140px;
        max-width: 170px;
        height: 34px;
        font-size: 0.82em;
        padding: 0 18px;
    }

    .hairstyle-options-group-wrapper {
        gap: 16px;
        padding: 0 calc(50vw - 60px) 16px;
    }

    .booking-modal {
        padding: 24px;
        width: 95%;
    }

    .booking-modal h2 {
        font-size: 1.5em;
    }
}

@media (min-width: 601px) {
    #central-viewport {
        width: var(--viewport-size-desktop);
        height: var(--viewport-size-desktop);
    }
}
    </style>
</head>
<body>
    <div id="app-header">
        <div id="main-title-container">
            <h1 id="main-title">Looks</h1>
        </div>
    </div>

    <div id="main-app-container">
        
        <!-- SECTION 1: CAMERA/SELFIE (Hero Element) -->
        <div id="central-section">
            <div id="central-viewport">
                <div id="camera-placeholder-icon"></div>
                <video id="video-feed" autoplay playsinline></video>
                <img id="ai-result" style="display: none;" src="" alt="AI Hairstyle Result">
                <img id="style-preview-overlay" src="" alt="Style Preview">
                <p id="status-message">Tap to take selfie</p>
            </div>
        </div>
        
        <!-- SECTION 2: ACTION BUTTONS -->
        <div id="controls-footer-row">
            <button id="camera-capture-btn" class="circular-action-btn main-action-btn" disabled>ðŸ“¸</button>
            <button id="redo-selfie-btn" class="circular-action-btn main-action-btn" style="display: none;">ðŸ”„</button>
            <button id="generate-look-btn" class="circular-action-btn main-action-btn" style="display: none;">âœ¨</button>
            <div id="loading-spinner" style="display: none;"></div>
            <button id="book-appointment-btn" class="main-action-btn" style="display: none;">Book Appointment</button>
        </div>

        <!-- SECTION 3: STYLE GALLERY (Snapchat-style) -->
        <div id="style-inspiration-section">
            <p>Swipe to browse styles</p>
            <div id="male-hairstyle-options-group" class="hairstyle-options-group-wrapper"></div>
            <div id="female-hairstyle-options-group" class="hairstyle-options-group-wrapper" style="display: none;">
                <div class="style-option" data-prompt="A shoulder-length cut with soft waves and natural volume, warm brunette color, gentle face-framing layers.">
                    <img class="style-thumbnail" src="styles/female/style1.png" alt="Soft Wavy Layers">
                    <p>Soft Wavy Layers</p>
                </div>
                <div class="style-option" data-prompt="A long layered hairstyle with loose curls, dark brown color, flowing and romantic silhouette.">
                    <img class="style-thumbnail" src="styles/female/style2.png" alt="Long Loose Curls">
                    <p>Long Loose Curls</p>
                </div>
                <div class="style-option" data-prompt="A sleek straight bob cut at chin length, jet black color, sharp and modern profile.">
                    <img class="style-thumbnail" src="styles/female/style3.png" alt="Sleek Chin Bob">
                    <p>Sleek Chin Bob</p>
                </div>
                <div class="style-option" data-prompt="A textured lob with subtle waves, ash blonde color, effortless and airy finish.">
                    <img class="style-thumbnail" src="styles/female/style4.png" alt="Textured Wavy Lob">
                    <p>Textured Wavy Lob</p>
                </div>
                <div class="style-option" data-prompt="A short pixie cut with choppy layers, platinum blonde color, bold and edgy look.">
                    <img class="style-thumbnail" src="styles/female/style5.png" alt="Choppy Pixie Cut">
                    <p>Choppy Pixie Cut</p>
                </div>
                <div class="style-option" data-prompt="A long haircut with smooth straight strands, rich chestnut color, polished and elegant feel.">
                    <img class="style-thumbnail" src="styles/female/style6.png" alt="Long Sleek Layers">
                    <p>Long Sleek Layers</p>
                </div>
                <div class="style-option" data-prompt="A curly shoulder-length style with defined ringlets, deep black color, lively and full shape.">
                    <img class="style-thumbnail" src="styles/female/style7.png" alt="Defined Curly Cut">
                    <p>Defined Curly Cut</p>
                </div>
                <div class="style-option" data-prompt="A layered shag cut with curtain bangs, honey brown color, relaxed and trendy vibe.">
                    <img class="style-thumbnail" src="styles/female/style8.png" alt="Layered Shag Cut">
                    <p>Layered Shag Cut</p>
                </div>
                <div class="style-option" data-prompt="A blunt cut with long straight hair, cool dark brown color, clean and minimalist outline.">
                    <img class="style-thumbnail" src="styles/female/style9.png" alt="Blunt Long Cut">
                    <p>Blunt Long Cut</p>
                </div>
                <div class="style-option" data-prompt="A medium-length wavy cut with beachy texture, sandy blonde color, soft and casual movement.">
                    <img class="style-thumbnail" src="styles/female/style10.png" alt="Beachy Waves">
                    <p>Beachy Waves</p>
                </div>
                <div class="style-option" data-prompt="A short bob with flipped-out ends, caramel brown color, playful and retro-inspired shape.">
                    <img class="style-thumbnail" src="styles/female/style11.png" alt="Flipped Bob">
                    <p>Flipped Bob</p>
                </div>
                <div class="style-option" data-prompt="A long hairstyle with voluminous waves, golden blonde color, glamorous and flowing look.">
                    <img class="style-thumbnail" src="styles/female/style12.png" alt="Voluminous Waves">
                    <p>Voluminous Waves</p>
                </div>
                <div class="style-option" data-prompt="A cropped pixie with tapered sides, silver blonde color, sharp and confident style.">
                    <img class="style-thumbnail" src="styles/female/style13.png" alt="Tapered Pixie">
                    <p>Tapered Pixie</p>
                </div>
                <div class="style-option" data-prompt="A medium-length straight cut with subtle layers, natural black color, smooth and balanced profile.">
                    <img class="style-thumbnail" src="styles/female/style14.png" alt="Straight Medium Cut">
                    <p>Straight Medium Cut</p>
                </div>
                <div class="style-option" data-prompt="A long curly style with layered volume, auburn brown color, soft and expressive texture.">
                    <img class="style-thumbnail" src="styles/female/style15.png" alt="Layered Curly Long">
                    <p>Layered Curly Long</p>
                </div>
                <div class="style-option" data-prompt="An asymmetrical bob with one side longer, dark espresso color, modern and fashion-forward feel.">
                    <img class="style-thumbnail" src="styles/female/style16.png" alt="Asymmetrical Bob">
                    <p>Asymmetrical Bob</p>
                </div>
                <div class="style-option" data-prompt="A shoulder-length cut with feathered layers, light brown color, airy and lightweight finish.">
                    <img class="style-thumbnail" src="styles/female/style17.png" alt="Feathered Layers">
                    <p>Feathered Layers</p>
                </div>
                <div class="style-option" data-prompt="A sleek high ponytail with smooth strands, dark brown color, clean and lifted silhouette.">
                    <img class="style-thumbnail" src="styles/female/style18.png" alt="Sleek High Ponytail">
                    <p>Sleek High Ponytail</p>
                </div>
                <div class="style-option" data-prompt="A half-up hairstyle with loose waves, soft brunette color, romantic and relaxed look.">
                    <img class="style-thumbnail" src="styles/female/style19.png" alt="Half-Up Waves">
                    <p>Half-Up Waves</p>
                </div>
                <div class="style-option" data-prompt="A braided crown hairstyle with loose tendrils, warm brown color, delicate and elegant detail.">
                    <img class="style-thumbnail" src="styles/female/style20.png" alt="Braided Crown">
                    <p>Braided Crown</p>
                </div>
                <div class="style-option" data-prompt="A long straight hairstyle with blunt bangs, deep black color, bold and striking contrast.">
                    <img class="style-thumbnail" src="styles/female/style21.png" alt="Blunt Bangs Long">
                    <p>Blunt Bangs Long</p>
                </div>
            </div>
        </div>
        
        <!-- SECTION 4: COMPACT FILTERS (Below styles, at bottom) -->
        <div id="filters-combined-row">
            <div class="filter-group">
                <p class="filter-label">Gender</p>
                <div class="gender-buttons-container">
                    <button id="male-gender-btn" class="gender-button">Male</button>
                    <button id="female-gender-btn" class="gender-button">Female</button>
                </div>
            </div>
            
            <div class="filter-separator"></div>
            
            <div class="filter-group">
                <p class="filter-label">Skin Tone</p>
                <div id="additional-filters-selector" class="filter-section collapsed">
                    <h3><span>+ Additional Filters</span></h3>
                    <div class="filter-content-group">
                        <div id="complexion-options-group" class="filter-options-group">
                            <div class="complexion-tile" style="background-color: #F8D7BE;" data-complexion="Light" data-complexion-code="default"></div>
                            <div class="complexion-tile" style="background-color: #D6A476;" data-complexion="Medium" data-complexion-code="default"></div>
                            <div class="complexion-tile" style="background-color: #A97A52;" data-complexion="Dark" data-complexion-code="ds"></div>
                            <div class="complexion-tile" style="background-color: #6A3E26;" data-complexion="Deep" data-complexion-code="ds"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <canvas id="hidden-canvas" style="display: none;"></canvas>

    <div id="booking-modal-overlay" class="modal-overlay">
        <div class="booking-modal">
            <button class="modal-close-btn" id="modal-close-btn">&times;</button>
            <h2>Book Your Look</h2>
            <div class="modal-content">
                <p style="color: var(--text-secondary); margin-bottom: 12px;">You are booking the style reference below:</p>
                <img id="reference-image-preview" src="" alt="AI Generated Style Reference">
                <p style="font-size: 0.9em; margin-top: 8px; color: var(--text-secondary); font-weight: 600;">
                    Style: <span id="selected-style-name" style="color: var(--primary-color);"></span>
                </p>
                
                <form id="booking-form">
                    <label for="name">Your Name</label>
                    <input type="text" id="name" name="name" required placeholder="John Smith">

                    <label for="email">Email</label>
                    <input type="email" id="email" name="email" required placeholder="john@example.com">

                    <label for="date">Select Date</label>
                    <input type="date" id="date" name="date" required>

                    <label for="time">Select Time</label>
                    <select id="time" name="time" required>
                        <option value="">Select a date first...</option>
                    </select>

                    <button type="submit" class="submit-btn" disabled>Confirm Booking</button>
                    <p id="booking-status-message"></p>
                </form>
            </div>
        </div>
    </div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    const videoFeed = document.getElementById('video-feed');
    const aiResultImg = document.getElementById('ai-result');
    const canvas = document.getElementById('hidden-canvas');
    const cameraPlaceholderIcon = document.getElementById('camera-placeholder-icon');
    const cameraCaptureBtn = document.getElementById('camera-capture-btn');
    const redoSelfieBtn = document.getElementById('redo-selfie-btn');
    const generateLookBtn = document.getElementById('generate-look-btn');
    const bookAppointmentBtn = document.getElementById('book-appointment-btn');
    const spinner = document.getElementById('loading-spinner');
    const statusMessage = document.getElementById('status-message');
    const stylePreviewOverlay = document.getElementById('style-preview-overlay');
    const filtersAccordion = document.getElementById('additional-filters-selector');
    const complexionGroup = document.getElementById('complexion-options-group');
    const maleStyleOptionsGroup = document.getElementById('male-hairstyle-options-group');
    const femaleStyleOptionsGroup = document.getElementById('female-hairstyle-options-group');
    const maleGenderBtn = document.getElementById('male-gender-btn');
    const femaleGenderBtn = document.getElementById('female-gender-btn');
    const bookingModalOverlay = document.getElementById('booking-modal-overlay');
    const modalCloseBtn = document.getElementById('modal-close-btn');
    const bookingForm = document.getElementById('booking-form');
    const referenceImagePreview = document.getElementById('reference-image-preview');
    const selectedStyleNameSpan = document.getElementById('selected-style-name');
    const dateInput = document.getElementById('date');
    const timeSelect = document.getElementById('time');

    let capturedImageBase64 = null;
    let selectedPrompt = null;
    let selectedStyleLabel = null;
    let cameraStarted = false;
    let selectedGender = 'Male';
    let selectedComplexionCode = null;
    let imageCaptured = false;
    let aiGenerationComplete = false;

    const NEGATIVE_PROMPT = "extra fingers, blurry, low resolution, bad hands, deformed face, mask artifact, bad blending, unnatural hair hair color, ugly, tiling, duplicate, abstract, cartoon, distorted pupils, bad lighting, cropped, grainy, noise, poor lighting, poor composition, low quality, changed clothing, changed background, new outfit, new background, different lighting";

    // Fun loading messages
    const LOADING_MESSAGES = [
        "âœ‚ï¸ Consulting our AI stylist...",
        "ðŸ’ˆ Mixing the perfect blend...",
        "âœ¨ Adding the finishing touches...",
        "ðŸŽ¨ Creating your new look...",
        "ðŸ’‡ Styling in progress...",
        "ðŸ”® Working some magic...",
        "âš¡ Almost there..."
    ];
    
    let loadingMessageInterval = null;

    // Haptic feedback helper (vibration on mobile)
    function triggerHaptic(pattern = 10) {
        try {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        } catch (e) {
            // Silently fail if vibration not supported
        }
    }

    const ALL_MALE_STYLES = [
        { code: 'default', src: "styles/male/style1.png", label: "Tousled Short Crop", prompt: "A short haircut with a tousled and textured top, dark brown color, sharp side profile." },
        { code: 'default', src: "styles/male/style2.png", label: "Wavy Clean Fade", prompt: "A clean fade with a slightly messy wavy top, medium brown color, defined jawline framing" },
        { code: 'default', src: "styles/male/style3.png", label: "Classic Side-Part", prompt: "A classic side-part with a smooth combed finish, ash black color, crisp temple blend." },
        { code: 'default', src: "styles/male/style4.png", label: "Curly Short Crop", prompt: "A short curly crop with tight texture, deep black color, taper fade around the ears." },
        { code: 'default', src: "styles/male/style5.png", label: "Layered Shag Cut", prompt: "A medium-length shag with layered volume, chestnut brown color, soft silhouette." },
        { code: 'default', src: "styles/male/style6.png", label: "Textured Buzz", prompt: "A buzz cut with subtle texture on top, dark blonde color, strong and structured profile." },
        { code: 'default', src: "styles/male/style7.png", label: "Modern Quiff", prompt: "A modern quiff with height and soft edges, dark brown color, low fade on the sides." },
        { code: 'default', src: "styles/male/style8.png", label: "Textured Fringe", prompt: "A textured fringe with choppy layers, sandy brown color, relaxed and youthful feel." },
        { code: 'default', src: "styles/male/style9.png", label: "Wavy Slick-Back", prompt: "A slick-back style with slight wave, espresso black color, clean undercut detail." },
        { code: 'default', src: "styles/male/style10.png", label: "Caesar Crop", prompt: "A cropped Caesar cut with short bangs, warm brown color, sharp and tidy shape." },
        { code: 'default', src: "styles/male/style11.png", label: "Swept-Back Medium", prompt: "A medium-length swept-back style with natural flow, golden brown color, tapered sides." },
        { code: 'default', src: "styles/male/style12.png", label: "Curly Undercut", prompt: "A curly undercut with defined top volume, jet black color, bold contrast in lengths." },
        { code: 'default', src: "styles/male/style13.png", label: "Messy Medium Crop", prompt: "A messy medium crop with subtle waves, chocolate brown color, soft shadow fade." },
        { code: 'default', src: "styles/male/style14.png", label: "Spiky Short Fade", prompt: "A spiky short top with controlled texture, dark brown color, sharp high fade." },
        { code: 'default', src: "styles/male/style15.png", label: "Forward Brush Cut", prompt: "A long top with brushed-forward texture, deep mahogany color, tight sides for structure." },
        { code: 'default', src: "styles/male/style16.png", label: "Textured Buzz Fade", prompt: "A low-maintenance textured buzz with slight stubble blend, dark ash brown color." },
        { code: 'default', src: "styles/male/style17.png", label: "Smooth Pompadour", prompt: "A voluminous pompadour with smooth finish, black-brown color, clean and polished sides." },
        { code: 'default', src: "styles/male/style18.png", label: "Surfer Waves", prompt: "A relaxed surfer-style wave with medium length, sandy blonde color, natural movement." },
        { code: 'default', src: "styles/male/style19.png", label: "High-Contrast Crop", prompt: "A detailed crop with high contrast fade, smoky black color, strong forehead line." },
        { code: 'default', src: "styles/male/style20.png", label: "Layered Side Sweep", prompt: "A medium layered cut with side sweep, warm auburn brown color, gentle taper." },
        { code: 'default', src: "styles/male/style21.png", label: "Modern Mullet", prompt: "A modern mullet with short front and layered back flow, dark charcoal color, bold silhouette." },
        { code: 'ds', src: "styles/male/ds/1.png", label: "Low Fade Coils", prompt: "A low fade with short tight coils on top, natural black color, clean hairline finish." },
        { code: 'ds', src: "styles/male/ds/2.png", label: "Classic Afro", prompt: "A classic afro with rounded shape, dense texture, bold and balanced silhouette." },
        { code: 'ds', src: "styles/male/ds/3.png", label: "Short Twists Fade", prompt: "Short twists with a taper fade, deep black color, neat and modern profile." },
        { code: 'ds', src: "styles/male/ds/4.png", label: "Wave Crop", prompt: "A cropped cut with waves brushed forward, jet black color, sharp temple lines." },
        { code: 'ds', src: "styles/male/ds/5.png", label: "High-Top Fade", prompt: "A high-top fade with structured volume, natural black color, strong vertical shape." },
        { code: 'ds', src: "styles/male/ds/6.png", label: "Clean Buzz Cut", prompt: "A buzz cut with precise edge-up, dark black color, minimal and clean look." },
        { code: 'ds', src: "styles/male/ds/7.png", label: "Pulled-Back Locs", prompt: "Medium-length locs pulled back, natural black color, relaxed and confident style." },
        { code: 'ds', src: "styles/male/ds/8.png", label: "Sponge Curl Fade", prompt: "A short curly fade with sponge-textured top, dense coils, smooth side blend." },
        { code: 'ds', src: "styles/male/ds/9.png", label: "Straight Cornrows", prompt: "Cornrow braids with straight-back pattern, natural black color, clean scalp lines." },
        { code: 'ds', src: "styles/male/ds/10.png", label: "Tapered Afro", prompt: "A tapered afro with controlled volume, matte black color, soft rounded outline." },
        { code: 'ds', src: "styles/male/ds/11.png", label: "Curly Frohawk", prompt: "A short frohawk with faded sides, tight curls, bold center emphasis." },
        { code: 'ds', src: "styles/male/ds/12.png", label: "Finger Coils", prompt: "Defined finger coils with low taper, black color, glossy textured finish." },
        { code: 'ds', src: "styles/male/ds/13.png", label: "Bald Fade Curls", prompt: "A bald fade with very short, naturally lying curls on top, dark black tone, crisp contrast." },
        { code: 'ds', src: "styles/male/ds/14.png", label: "Freeform Locs", prompt: "Freeform locs with medium length, natural texture, organic silhouette." },
        { code: 'ds', src: "styles/male/ds/15.png", label: "Burst Fade Curls", prompt: "A burst fade with curly top, black color, rounded side profile." },
        { code: 'ds', src: "styles/male/ds/16.png", label: "Short Box Braids", prompt: "Short box braids with neat parting, dark black color, uniform structure." },
        { code: 'ds', src: "styles/male/ds/17.png", label: "Flat Brush Cut", prompt: "A flat brush cut with subtle wave pattern, jet black color, sharp geometry." },
        { code: 'ds', src: "styles/male/ds/18.png", label: "Short Afro Crop", prompt: "A short afro crop with even density, natural black tone." }
    ];

    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    function createStyleElement(style) {
        const div = document.createElement('div');
        div.className = 'style-option';
        div.dataset.prompt = style.prompt;
        div.dataset.complexionCode = style.code;
        
        const img = document.createElement('img');
        img.className = 'style-thumbnail';
        img.src = style.src;
        img.alt = style.label;
        
        const p = document.createElement('p');
        p.textContent = style.label;

        div.appendChild(img);
        div.appendChild(p);
        
        div.addEventListener('click', () => handleStyleSelect(div));
        return div;
    }

    function renderStyles(container, stylesArray) {
        container.innerHTML = '';
        stylesArray.forEach(style => {
            container.appendChild(createStyleElement(style));
        });
        setupScrollListeners(container);
    }

    function updateMaleStyleGallery(filterCode = null) {
        let filteredStyles;
        if (filterCode) {
            filteredStyles = ALL_MALE_STYLES.filter(style => style.code === filterCode);
        } else {
            filteredStyles = ALL_MALE_STYLES;
        }
        const shuffledStyles = shuffle([...filteredStyles]);
        renderStyles(maleStyleOptionsGroup, shuffledStyles);
        selectedPrompt = null;
        selectedStyleLabel = null;
        updateButtonVisibility();
        maleStyleOptionsGroup.scrollLeft = 0;
    }

    function updateButtonVisibility() {
        cameraCaptureBtn.style.display = 'none';
        redoSelfieBtn.style.display = 'none';
        generateLookBtn.style.display = 'none';
        bookAppointmentBtn.style.display = 'none';
        spinner.style.display = 'none';

        if (spinner.classList.contains('active')) {
            spinner.style.display = 'block';
        } else if (aiGenerationComplete) {
            redoSelfieBtn.style.display = 'flex';
            bookAppointmentBtn.style.display = 'flex';
            statusMessage.textContent = `Ready to book! Or try another style`;
        } else if (imageCaptured) {
            redoSelfieBtn.style.display = 'flex';
            if (selectedPrompt) {
                generateLookBtn.style.display = 'flex';
                generateLookBtn.disabled = false;
                statusMessage.textContent = `Tap âœ¨ to generate your new look`;
            } else {
                statusMessage.textContent = "Select a hairstyle below";
            }
        } else {
            cameraCaptureBtn.style.display = 'flex';
            cameraCaptureBtn.disabled = !cameraStarted;
            if (cameraStarted) {
                statusMessage.textContent = "Position your face, then tap ðŸ“¸";
            } else {
                statusMessage.textContent = "Tap above to take a selfie";
            }
        }
    }

    function findClosestToCenter(scrollContainer, styleOptions) {
        const containerCenter = scrollContainer.scrollLeft + (scrollContainer.clientWidth / 2);
        let closestOption = null;
        let minDifference = Infinity;

        styleOptions.forEach(option => {
            const optionCenter = option.offsetLeft + (option.offsetWidth / 2);
            const difference = Math.abs(optionCenter - containerCenter);
            if (difference < minDifference) {
                minDifference = difference;
                closestOption = option;
            }
        });
        return closestOption;
    }

    function updateStyleSelectionOnScroll(scrollContainer, allOptions) {
        if (scrollContainer.style.display === 'none') return;
        const closestOption = findClosestToCenter(scrollContainer, allOptions);
        if (closestOption) {
            if (!closestOption.classList.contains('selected')) {
                allOptions.forEach(o => o.classList.remove('selected'));
                closestOption.classList.add('selected');
            }
            if (selectedPrompt !== closestOption.dataset.prompt) {
                selectedPrompt = closestOption.dataset.prompt;
                selectedStyleLabel = closestOption.querySelector('p').textContent || closestOption.dataset.prompt;
                updateButtonVisibility();
            }
        }
    }

    const setupScrollListeners = (groupWrapper) => {
        const allOptions = groupWrapper.querySelectorAll('.style-option');
        if (allOptions.length === 0) return;

        const scrollHandler = () => {
            updateStyleSelectionOnScroll(groupWrapper, allOptions);
        };

        const oldHandler = groupWrapper._scrollHandler;
        if (oldHandler) {
            groupWrapper.removeEventListener('scroll', oldHandler);
        }

        groupWrapper.addEventListener('scroll', scrollHandler);
        groupWrapper._scrollHandler = scrollHandler;
        scrollHandler();
    };

    function handleGenderSelect(gender) {
        triggerHaptic(10); // Light haptic
        selectedComplexionCode = null;
        complexionGroup.querySelectorAll('.complexion-tile').forEach(t => t.classList.remove('selected'));
        selectedGender = gender;
        maleGenderBtn.classList.remove('selected');
        femaleGenderBtn.classList.remove('selected');
        
        if (gender === 'Male') {
            maleGenderBtn.classList.add('selected');
            maleStyleOptionsGroup.style.display = 'flex';
            femaleStyleOptionsGroup.style.display = 'none';
            filtersAccordion.style.display = 'block';
            updateMaleStyleGallery(null);
        } else if (gender === 'Female') {
            femaleGenderBtn.classList.add('selected');
            maleStyleOptionsGroup.style.display = 'none';
            femaleStyleOptionsGroup.style.display = 'flex';
            filtersAccordion.style.display = 'none';
            setupScrollListeners(femaleStyleOptionsGroup);
        }
        if (imageCaptured) resetSession();
    }

    function toggleFilterSection(section) {
        if (section.classList.contains('collapsed')) {
            section.classList.remove('collapsed');
            section.classList.add('expanded');
        } else {
            section.classList.remove('expanded');
            section.classList.add('collapsed');
        }
    }

    function handleComplexionSelect(tile) {
        if (selectedGender !== 'Male') return;
        
        triggerHaptic(10); // Light haptic
        
        const isSelected = tile.classList.contains('selected');
        const complexionTiles = complexionGroup.querySelectorAll('.complexion-tile');
        const code = tile.dataset.complexionCode;
        complexionTiles.forEach(t => t.classList.remove('selected'));
        let newFilterCode = null;
        if (!isSelected) {
            tile.classList.add('selected');
            newFilterCode = code;
        }
        selectedComplexionCode = newFilterCode;
        updateMaleStyleGallery(selectedComplexionCode);
    }

    function handleStyleSelect(styleOption) {
        triggerHaptic(8); // Very light haptic - subtle feedback
        const scrollContainer = styleOption.closest('.hairstyle-options-group-wrapper');
        if (scrollContainer) {
            const containerWidth = scrollContainer.clientWidth;
            const optionWidth = styleOption.offsetWidth;
            const scrollTarget = styleOption.offsetLeft - (containerWidth / 2) + (optionWidth / 2);
            scrollContainer.scrollTo({ left: scrollTarget, behavior: 'smooth' });
        }
    }

    async function startCamera() {
        if (cameraStarted) return;
        statusMessage.textContent = "Requesting camera access...";
        cameraCaptureBtn.disabled = true;
        try {
            const constraints = {
                video: { facingMode: 'user', width: { ideal: 250 }, height: { ideal: 250 } }
            };
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            videoFeed.srcObject = stream;
            await new Promise(resolve => {
                videoFeed.onloadedmetadata = () => {
                    videoFeed.play();
                    resolve();
                };
            });
            cameraStarted = true;
            imageCaptured = false;
            aiGenerationComplete = false;
            cameraPlaceholderIcon.style.display = 'none';
            aiResultImg.style.display = 'none';
            videoFeed.style.display = 'block';
            updateButtonVisibility();
        } catch (error) {
            console.error('Error accessing camera:', error);
            statusMessage.textContent = `Camera access denied. Please check permissions.`;
            cameraPlaceholderIcon.style.display = 'block';
            videoFeed.style.display = 'none';
            cameraStarted = false;
            updateButtonVisibility();
        }
    }

    function stopCamera() {
        if (videoFeed.srcObject) {
            videoFeed.srcObject.getTracks().forEach(track => track.stop());
            videoFeed.srcObject = null;
        }
        cameraStarted = false;
    }

    function captureImage() {
        if (!cameraStarted) return;
        
        triggerHaptic(20); // Medium haptic - satisfying capture feedback
        
        const context = canvas.getContext('2d');
        const width = videoFeed.videoWidth || 250;
        const height = videoFeed.videoHeight || 250;
        canvas.width = width;
        canvas.height = height;
        context.drawImage(videoFeed, 0, 0, width, width);
        const fullDataURL = canvas.toDataURL('image/jpeg');
        const parts = fullDataURL.split(',');
        capturedImageBase64 = parts.length > 1 ? parts[1] : fullDataURL;
        imageCaptured = true;
        aiGenerationComplete = false;
        videoFeed.style.display = 'none';
        aiResultImg.style.display = 'block';
        aiResultImg.src = fullDataURL;
        stopCamera();
        updateButtonVisibility();
    }

    function resetSession() {
        stopCamera();
        aiResultImg.style.display = 'none';
        cameraPlaceholderIcon.style.display = 'block';
        imageCaptured = false;
        aiGenerationComplete = false;
        capturedImageBase64 = null;
        spinner.classList.remove('active');
        if(selectedGender === 'Male') {
            updateMaleStyleGallery(selectedComplexionCode);
        } else {
            setupScrollListeners(femaleStyleOptionsGroup);
        }
        filtersAccordion.classList.remove('expanded');
        filtersAccordion.classList.add('collapsed');
        updateButtonVisibility();
    }

    cameraCaptureBtn.addEventListener('click', captureImage);
    cameraPlaceholderIcon.addEventListener('click', () => {
        if (!cameraStarted && !imageCaptured) {
            triggerHaptic(10); // Light haptic
            startCamera();
        }
    });
    redoSelfieBtn.addEventListener('click', () => {
        triggerHaptic(15); // Medium haptic
        resetSession();
        startCamera();
    });

    generateLookBtn.addEventListener('click', async () => {
        if (!capturedImageBase64 || !selectedPrompt) {
            statusMessage.textContent = "Please capture a selfie and select a hairstyle first.";
            triggerHaptic([50, 100, 50]); // Double buzz error pattern
            return;
        }
        
        triggerHaptic(30); // Strong haptic - important action!

        spinner.classList.add('active');
        updateButtonVisibility();
        
        // Fun loading messages that rotate every 2 seconds
        const loadingMessages = [
            "âœ‚ï¸ Consulting our AI stylist...",
            "ðŸ’ˆ Mixing the perfect blend...",
            "ðŸŽ¨ Adding the finishing touches...",
            "âœ¨ Creating your new look...",
            "ðŸ’‡ Styling your hair...",
            "ðŸ”® Working some magic..."
        ];
        
        let messageIndex = 0;
        statusMessage.textContent = loadingMessages[0];
        
        const messageInterval = setInterval(() => {
            messageIndex = (messageIndex + 1) % loadingMessages.length;
            statusMessage.textContent = loadingMessages[messageIndex];
        }, 2000);

        const complexionClause = selectedComplexionCode
            ? ` with a ${selectedComplexionCode === 'ds' ? 'darkest' : 'standard'} complexion`
            : ``;
        const finalPrompt = `STRICTLY operate in an inpainting/editing mode. The ONLY element to be changed is the subject's hair. PRESERVE the subject's face, identity, expression, clothing, and background EXACTLY as they appear in the original photograph. Apply the following hairstyle, matching its texture, color, and shape: ${selectedPrompt}. The final result must be a high quality, professional studio portrait of a ${selectedGender} model${complexionClause} with NO other changes besides the hair.`;
        try {
            const response = await fetch('/.netlify/functions/run_model', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    baseImage: capturedImageBase64,
                    prompt: finalPrompt,
                    negativePrompt: NEGATIVE_PROMPT
                })
            });
            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.error || `HTTP error! Status: ${response.status}`);
            }
            const data = await response.json();
            
            clearInterval(messageInterval); // Stop messages
            
            triggerHaptic([30, 50, 30, 50, 30]); // Triple success buzz!
            
            aiResultImg.src = `data:image/jpeg;base64,${data.generatedImageBase64}`;
            aiResultImg.style.display = 'block';
            videoFeed.style.display = 'none';
            cameraPlaceholderIcon.style.display = 'none';
            aiGenerationComplete = true;
            imageCaptured = true;
            capturedImageBase64 = data.generatedImageBase64;
            spinner.classList.remove('active');
            updateButtonVisibility();
        } catch (error) {
            clearInterval(messageInterval); // Stop messages on error
            console.error('AI Processing Error:', error);
            statusMessage.textContent = `Error: ${error.message}. Please try again.`;
            spinner.classList.remove('active');
            updateButtonVisibility();
        }
    });

    bookAppointmentBtn.addEventListener('click', () => {
        if (!aiGenerationComplete) {
            statusMessage.textContent = "Please generate a look first before booking.";
            triggerHaptic([50, 100, 50]); // Double buzz error
            return;
        }
        triggerHaptic(20); // Medium haptic
        referenceImagePreview.src = aiResultImg.src;
        selectedStyleNameSpan.textContent = selectedStyleLabel;
        const tomorrow = new Date();
        tomorrow.setDate(tomorrow.setDate() + 1);
        dateInput.min = tomorrow.toISOString().split('T')[0];
        bookingModalOverlay.classList.add('visible');
    });

    modalCloseBtn.addEventListener('click', () => {
        bookingModalOverlay.classList.remove('visible');
    });

    dateInput.addEventListener('change', async (e) => {
        const selectedDate = e.target.value;
        const submitButton = bookingForm.querySelector('.submit-btn');
        if (!selectedDate) return;
        timeSelect.innerHTML = '<option value="">Loading...</option>';
        submitButton.disabled = true;
        try {
            const response = await fetch('/.netlify/functions/get-availability', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ date: selectedDate })
            });
            const data = await response.json();
            if (data.availableSlots && data.availableSlots.length > 0) {
                timeSelect.innerHTML = '<option value="">Select a time...</option>';
                data.availableSlots.forEach(slot => {
                    const option = document.createElement('option');
                    option.value = slot.time;
                    option.textContent = slot.time;
                    timeSelect.appendChild(option);
                });
            } else {
                timeSelect.innerHTML = '<option value="">No times available</option>';
            }
        } catch (error) {
            console.error('Error fetching availability:', error);
            timeSelect.innerHTML = '<option value="">Error - try again</option>';
        }
    });

    timeSelect.addEventListener('change', (e) => {
        const submitButton = bookingForm.querySelector('.submit-btn');
        submitButton.disabled = !e.target.value;
    });

    bookingForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const bookingStatusMessage = document.getElementById('booking-status-message');
        const submitButton = bookingForm.querySelector('.submit-btn');
        submitButton.textContent = "Processing...";
        submitButton.disabled = true;
        bookingStatusMessage.style.color = '#f59e0b';
        bookingStatusMessage.textContent = "Creating your appointment...";
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const date = document.getElementById('date').value;
        const time = document.getElementById('time').value;
        const bookingData = {
            firstName: name.split(' ')[0] || '',
            lastName: name.split(' ').slice(1).join(' ') || '',
            email: email,
            datetime: `${date}T${time}:00`,
            appointmentType: selectedGender === 'Male' ? "Men's Cut" : "Women's Cut",
            styleName: selectedStyleLabel,
            stylePrompt: selectedPrompt,
            imageReference: aiResultImg.src
        };
        try {
            const response = await fetch('/.netlify/functions/create-booking', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(bookingData)
            });
            const result = await response.json();
            if (result.success) {
                bookingStatusMessage.style.color = 'var(--success-color)';
                bookingStatusMessage.textContent = "âœ“ Booking confirmed!";
                submitButton.textContent = "Confirmed!";
                setTimeout(() => {
                    bookingModalOverlay.classList.remove('visible');
                    bookingForm.reset();
                    submitButton.textContent = "Confirm Booking";
                    submitButton.disabled = true;
                    bookingStatusMessage.textContent = "";
                    timeSelect.innerHTML = '<option value="">Select a date first...</option>';
                }, 2500);
            } else {
                throw new Error(result.error || 'Booking failed');
            }
        } catch (error) {
            console.error('Booking error:', error);
            bookingStatusMessage.style.color = '#ef4444';
            bookingStatusMessage.textContent = `Error: ${error.message}`;
            submitButton.textContent = "Try Again";
            submitButton.disabled = false;
        }
    });

    function initialize() {
        if (maleGenderBtn) {
            maleGenderBtn.addEventListener('click', () => handleGenderSelect('Male'));
        }
        if (femaleGenderBtn) {
            femaleGenderBtn.addEventListener('click', () => handleGenderSelect('Female'));
        }
        if (filtersAccordion) {
            // Filters are now always visible, no toggle needed
            filtersAccordion.classList.add('collapsed'); // Keep in collapsed state to show pills
        }
        if (complexionGroup) {
            complexionGroup.querySelectorAll('.complexion-tile').forEach(tile => {
                tile.addEventListener('click', () => handleComplexionSelect(tile));
            });
        }
        handleGenderSelect('Male');
    }

    initialize();
});
    </script>
</body>
</html>
